#!/bin/bash

set -euo pipefail

(
    echo "NODE CPU_REQUEST CPU_LIMIT MEM_REQUEST MEM_LIMIT"
    echo "---- ----------- --------- ----------- ---------"

    kubectl "$@" describe nodes -l 'gravitational.io/k8s-role!=master' \
        | grep -A2 '^Name:\|^  CPU' \
        | grep '^Name:\|%' \
        | paste - - \
        | sed -e 's/[[:space:]]\+/ /g' \
        | cut -d ' ' -f 2- \
        | sed -e 's/ (/_(/g' \
        | sort -ur \
        | sort -k2 \
) \
    | column -o ' | ' -t \
    | sed -e 's/_/ /g'


#        | grep -A2 '^Name:\|^  CPU\|gravitational.io/k8s-role' \
#        | grep '^Name:\|%\|k8s-role' \
#        | sed -e 's,gravitational.io/k8s-role=,,g' \
